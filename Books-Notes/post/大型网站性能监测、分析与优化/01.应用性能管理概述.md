# 01.应用性能管理概述

**基本要求**

1. 性能间题暴露前，尽早发现应用性能问题，减少对用户的持续影响。
2. 性能问题发现时，尽快修复主要性能问题，减小应用性能影响力度，最大程度改进用户体验。
3. 性能问题优化后，杜绝再次发生，可持续保持应用性能优化成果，防止性能退化。

**基本原则**

1. 在产品不同生命周期性能侧重不同，优先验证简单假设，从简单到复杂，优先选择足够简单、容易出现收益的方案。
2. 先别急着优化，优先规避性能恶化，事实和推测分开，事实验证推测，没有论证预期收益不做优化，把有限的精力投入到关键性能问题上。
3. 从前端到后端，从外到内层层剥离，缩小范围到模块，模块内部分割单元测试，确定优化目标。
4. 性能优化没有尽头，在高速迭代中完成优化的同时，还需要与时俱进。移动时代的当下，不断投入和提高移动应用性能更具价值。
5. 需要塑造情怀和氛围，追求高性能的工程师文化，写出快速友好的代码。另外，性能优化是持久战，是—个系统工程，需要耐得住寂寞。

**应用性能管理的角色与分工**

1. FE (前端研发）
    1. 分析前端程序执行效率，改进前端逻辑和代码性能。
    2. 前端公共框架和代码质量管理，前端发布质量规范。
    3. 负责前端JS测速、用户性能数据收集和分析，前端性能分析工具开发。
2. RD (架构师、 后端研发、移动研发）
    1. 分析程序执行效率、系统架构中的性能瓶颈，优化系统结构。
    2. 设计更好的应用系统架构和落地。
    3. 针对影响性能的模块和接口进行专题项目改进和持续迭代。
3. OP (运维）
    1. 分析系统运行状况（系统），分析系统资源使用情况（硬件）。
    2. 分析应用程序对资源的使用情况，应用程序执行效率及相关压力测试。
    3. 负责服务器硬件、软件、软件配置性能优化，前沿相关技术调研和落地。
    4. 提供与竞品的瓶颈分析、速度优化、评测报告、收益评估。
4. SYS (网络）
    1. IDC、CON、 硬件性能测试、 商务采购、 上架，新硬件调研和落地。
    2. 负责ROE外网、 内网传输及相关QoS保障，负责ROE、CON性能优化。
    3. 负责操作系统母盘、内核、TCP传输、网络路由等调优。

![](http://cdn-blog.liusixin.cn/WX20180821-155233@2x.png)

## 如何正确开始

**应用性能管理三部曲**

1. 监测。通过监测产品及竞争对手在各终端、各产品形态下的性能，例如PC、手机、平板终端及操作系统、网络、应用等，全面评估自身及竞争者的表现，并迅速定位故障及排错。
2. 分析。通过标准来评估网页／应用／网络IDC、ISP、CON等性能，为优化及资源投入提供依据，为优化效果提供衡量，提供性能及故障预警、报警。
3. 优化。通过网络、系统、前端、应用等各层进行体系优化，以将产品网页速度优化提升至业界最快为目标，进而提高用户忠诚度、购买意愿、品牌价值等。

**如何正确开始**

1. 部署监控。前期最重要的是部署监控，无论自有监测平台还是第三方监测，必须在实际进行优化前完成。因为如果没有对比测试，就无法证明优化效果。只有通过监控平台获取到竞品及网络相关的数据，才对确定优化方案具有参考价值。
2. 查找瓶颈。接下来对于这些监测对象和数据，需要分析出影响性能的瓶颈在哪？有哪些方面需要不断调整或深入监测？这—阶段的主要工作是搜集各种相关信息，方便接下来制定优化方案。
3. 确定方案。完成瓶颈查找后的下—步是确定优化方案。通过分析之前收集到的各种数据来进行判断，并完成需要发起性能优化的讨论及确定人力、资源投入的统筹。
4. 优化实施。这—步主要指优化方案的实现过程。例如研发从前端、后端、移动端进行全方位的代码和逻辑优化及硬件、网络升级等。由于某些优化会导致一些关联的问题发生，需要做好前期的沟通和充分的论证。而核心产品需要单独搭建线下测试环境，经充分测试没有问题后，在上线过程中还可以灰度做NB测试，通过监测真实用户的数据，选择最优方案。
5. 跟踪反馈。持续反馈也是非常重要的工作，性能优化是—个繁杂的系统工程，除了参与人和优化项多以外，有些优化是需要长时间持续优化的。并需要进一步建立周会或报告机制，需要指定各方向的负责人来跟踪并反馈。

另外，除了以上基本步骤以外，一些有助千正确地进行性能优化的思路分享如下：

1. 初期以探索为主，不急千优化。主要以找短板，搭建监测平台，掌握数据为主。中后期迭代过程中在稳定的前提下以重点优化核心产品为主。
2. 从视觉感受和数据监测上同时分析问题。在数据的基础上设定优化目标，从一开始就需要准备稳定可靠的长期应用性能监控机制。
3. 与关联的产品线提前接触。从设计优化方案到优化上线全程邀请他们一起参与，提前准备好应急方案。

性能优化伴随大量的页面和应用性能提升，而内容瘦身、业务合并会直接降低带宽成本和服务器投入。恰逢这两种成本是互联网企业运营成本主要构成，性能优化通常伴随以下成本减少：

1. 内容瘦身和大量使用全国CON, 减少、 北上广中心IDC带宽和服务器使用，降低带宽、 机架、 服务器成本。
2. 提升后端模块性能和迁移规模化的高性能集群，从而降低资源消耗，提高资源利用率，合理冗余以抵御灾难。
3. 通过服务器性能优化和管理，让资源管理透明化，预算估计更规范化，以减少不必要的资源闲置和浪费。